<<<<<<< HEAD
var filter = require('through2-filter').obj;
var Set = require('es6-set');
=======
var Stream = require('stream');
>>>>>>> f8417fafd5bf20d329bf2e3402fca16fd839cf1f

function prop(propName) {
  return function (data) {
    return data[propName];
  };
}

module.exports = unique;
<<<<<<< HEAD
function unique(propName, keyStore) {
  keyStore = keyStore || new Set();

=======
function unique(propName) {
>>>>>>> f8417fafd5bf20d329bf2e3402fca16fd839cf1f
  var keyfn = JSON.stringify;
  if (typeof propName === 'string') {
    keyfn = prop(propName);
  } else if (typeof propName === 'function') {
    keyfn = propName;
  }
<<<<<<< HEAD

  return filter(function (data) {
    var key = keyfn(data);

    if (keyStore.has(key)) {
      return false;
    } else {
      keyStore.add(key);
      return true;
    }
  });
=======
  var seen = {};
  var s = new Stream();
  s.readable = true;
  s.writable = true;
  var pipes = 0;

  s.write = function (data) {
    var key = keyfn(data);
    if (seen[key] === undefined) {
      seen[key] = true;
      s.emit('data', data);
    }
  };

  var ended = 0;
  s.end = function (data) {
    if (arguments.length) s.write(data);
    ended++;
    if (ended === pipes || pipes === 0) {
      s.writable = false;
      s.emit('end');
    }
  };

  s.destroy = function (data) {
    s.writable = false;
  };

  s.on('pipe', function () {
    pipes++;
  });

  s.on('unpipe', function () {
    pipes--;
  });

  return s;
>>>>>>> f8417fafd5bf20d329bf2e3402fca16fd839cf1f
}
