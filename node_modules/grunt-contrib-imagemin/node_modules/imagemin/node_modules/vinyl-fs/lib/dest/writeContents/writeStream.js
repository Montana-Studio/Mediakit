'use strict';

var streamFile = require('../../src/getContents/streamFile');
var fs = require('graceful-fs');

<<<<<<< HEAD
function writeStream(writePath, file, cb) {
  var opt = {
    mode: file.stat.mode,
    flag: file.flag
=======
function writeStream (writePath, file, cb) {
  var opt = {
    mode: file.stat.mode
>>>>>>> f8417fafd5bf20d329bf2e3402fca16fd839cf1f
  };

  var outStream = fs.createWriteStream(writePath, opt);

<<<<<<< HEAD
  file.contents.once('error', complete);
  outStream.once('error', complete);
  outStream.once('finish', success);

  file.contents.pipe(outStream);

  function success() {
    streamFile(file, complete);
  }

  // cleanup
  function complete(err) {
    file.contents.removeListener('error', cb);
    outStream.removeListener('error', cb);
    outStream.removeListener('finish', success);
    cb(err);
  }
=======
  file.contents.once('error', cb);
  outStream.once('error', cb);
  outStream.once('finish', function() {
    streamFile(file, cb);
  });

  file.contents.pipe(outStream);
>>>>>>> f8417fafd5bf20d329bf2e3402fca16fd839cf1f
}

module.exports = writeStream;
